const assert = require('assert');
const configNewRelic = require('../lib/new-relic-config');

describe('new relic config tests', function() {
  it('if this is test env, default enabled to false', function() {
    env(null);
    const result = configNewRelic('test', {});
    assert.deepEqual(result, {
      enabled: false
    });
  });

  it('if no options, default enabled to false', function() {
    env('dev14');
    const result = configNewRelic('test', {});
    assert.deepEqual(result, {
      enabled: false
    });
  });

  it('non-test env or options are present', function() {
    env('dev14');
    const result = configNewRelic('production', {
      nrKeys: {
        dev14: {
          applicationID: '12345',
          licenseKey: '9832973'
        }
      }
    });

    assert.deepEqual(result, {
      applicationID: '12345',
      licenseKey: '9832973',
      enabled: true
    });
  });
});

function env(tflyEnv) {
  process.env.TFLY_DEPLOY_TARGET = tflyEnv;
}
